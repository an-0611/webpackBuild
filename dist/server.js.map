{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"react\"","webpack:///external \"react-helmet\"","webpack:///external \"react-dom/server\"","webpack:///external \"styled-components\"","webpack:///external \"webpack\"","webpack:///external \"express\"","webpack:///./src/html.js","webpack:///./src/components/app.js","webpack:///./server.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","Html","this","props","helmet","appHtml","lang","title","toComponent","meta","content","httpEquiv","id","dangerouslySetInnerHTML","__html","type","src","Component","console","log","Container","styled","div","primary","css","App","state","callValue","alert","prefetch","className","onClick","express","app","port","process","env","PORT","req","res","Helmet","renderStatic","renderToString","send","renderToStaticMarkup","err","listen","error","use"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","module.exports = require(\"react\");","module.exports = require(\"react-helmet\");","module.exports = require(\"react-dom/server\");","module.exports = require(\"styled-components\");","module.exports = require(\"webpack\");","module.exports = require(\"express\");","import React, { Component } from 'react';\n\nclass Html extends Component {\n  render() {\n    const { helmet, appHtml } = this.props;\n    // const scripts = bundles.filter(bundle => bundle.file.endsWith('.js')).map(bundle => <script src={`${siteUrl}${bundle.file}${staticVer}`} />);\n    // const scripts = <script src=\"./main.js\" />;\n    // const scripts1 = <script src=\"./1.main.js\" />;\n    // manifest service is for PWA\n    // const style = {\n    //   'background': 'none'\n    // }\n    return (\n      <html lang=\"zh-TW\">\n        <head>\n          {helmet.title.toComponent()}\n          {helmet.meta.toComponent()}\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n          <meta httpEquiv=\"x-ua-compatible\" content=\"IE=edge\" />\n        </head>\n        <body id=\"body\">{/* style={ style } */}\n          <div id=\"app\" dangerouslySetInnerHTML={{ __html: appHtml }} />\n          {/* <div id=\"app\" dangerouslySetInnerHTML={{ __html: 'bodybody12333' }} /> */}\n          <script type=\"text/javascript\" src=\"vendors~bundle.js\" />{/* !!!!!!　 */}\n          {/* !!!!! app.use('/', express.static('dist')) 放在app.get()外面是client side render 放入 app.get內疚變成ssr */}\n          {/* 但此時的綑綁變為兩包(webpack有把綑綁拆成兩包) 這邊的vendors~bundle.js在ssr的時候抓不到 需手動添加進html.js 添加完即完成ssr */}\n\n          <script type=\"text/javascript\" src=\"bundle.js\" />{/* 包含所有client file */}\n          {/* <script type=\"text/javascript\" src={`${window.location.href}bundle.js`} /> */}{/* 還在server side抓不到window */}\n          {/* // https://github.com/jakoblind/universal-react-server-bundle/blob/master/webpack.config.js */}\n        </body>\n      </html>\n    );\n  }\n}\n\nexport default Html;","import React, { Component } from 'react'\nimport Helmet from 'react-helmet';\nimport styled, { css } from 'styled-components'\nimport { add } from '../common/index'\nconsole.log(add(1,2))\n\nconst Container = styled.div`\n  color: ${props => props.primary ? 'green' : 'red'};\n  text-align: center;\n  opaciy: 1;\n  ${props => props.primary && css`\n    background: white;\n    border: 1px solid black;\n  `};\n`\n// https://medium.com/webpack/webpack-4-import-and-commonjs-d619d626b655\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      value: 666,\n    };\n    this.callValue = this.callValue.bind(this);\n  }\n\n  callValue() {\n    alert(this.state.value)\n  }\n\n  render() {\n    return (\n      <Container prefetch>{/* prefetch預取 提前完成渲染? */}\n        <Helmet>\n          <title>helmet test</title>\n          <meta name=\"description\" content=\"desc ssr test\" />\n        </Helmet>\n        <div className=\"app\">webpack 4 環境建制</div>\n        <Container primary>\n          <div>test</div>\n          <button onClick={() => { this.callValue() }}>callValue</button>\n        </Container>\n      </Container>\n      // npm run git -- \"\" && postgit\n      // npm run git -- \"update css module\" && postgit\n      // 測試 build 好的檔案 'test': npm run build && mocha --compilers js:babel-core/register\n      // docker deploy => npm run build && docker-compose up -d https://codertw.com/%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80/188625/\n      // dockerfile setting https://www.jinnsblog.com/2018/12/docker-dockerfile-guide.html\n    );\n  }\n}\n\n// if (module.hot) module.hot.accept();\n\nexport default App;","import React from 'react';\n// const webpack = require('webpack')\nimport webpack from 'webpack'\n// const webpackDevMiddleware = require('webpack-dev-middleware')\n// const webpackHotMiddleware = require('webpack-hot-middleware')\n// const config = require('./webpack.config.js')\n\n// const http = require('http');\n\n// __dirname：總是返回被執行的js所在文件夾的絕對路徑\n// __filename：總是返回被執行的js的絕對路徑\n\nconst express = require('express')\nconst app = express();\nconst port = process.env.PORT || 8080; // 用docker 時換成8080,  webpack output記得改   \n// const host = process.env.PORT ? null : '0.0.0.0';\n\nimport { renderToStaticMarkup, renderToString } from 'react-dom/server';\n\n// import { ServerStyleSheet } from 'styled-components'\n\nimport { Helmet } from 'react-helmet';\n// how to set server.js to read es6  // 把server 拉到跟entry ./src/index.js 同一層 // dockerfile && package.json server.js's router also need to change\nimport Html from './src/html' // 使用 import 需先編譯打包至dist 開啟的server 路徑也改成 ./dist/server.js\nimport App from './src/components/app';\n\nif (process.env.PORT) {\n  try {\n    app.get('/', function(req, res) {\n      try {\n        const helmet = Helmet.renderStatic();\n        const appHtml = renderToString(<App />);\n        var bundles = [];\n\n        res.send(`<!doctype html>\\n${renderToStaticMarkup(<Html\n          helmet={helmet}\n          appHtml={appHtml}\n        />)}`);\n      } catch (err) {\n        console.log(err);\n      }\n    });\n      \n    app.listen(port, function(error) {\n      if (error) {\n        console.error(error)\n      } else {\n        console.log('伺服器已啟動在 port %s', port);\n      }\n    })\n\n  //   app.get('/', function(req, res) { // 之後改成ssr 先用測試\n  //     var body = '<!doctype html>' +\n  //       '<html lang=\"zh-TW\">'+\n  //       '<head><meta charset=\"utf-8\"></head>' +\n  //       '<body>' +\n  //       '<div>server render heroku test</div>'\n  //       '</body>'+\n  //       '</html>';\n  //     res.writeHead(200, {\"Content-Type\": \"text/html\"});\n  //     res.write(body);\n  //     res.end();\n  //   });\n  //   app.listen(port, () => console.log((`Listening on ${port}`))) // need listen port to run server\n  } catch(err) {\n    console.log(err)\n  }\n  \n} else {\n  console.log('本機伺服器啟動')\n  const host = '0.0.0.0';\n  // app.use(path, router) router 代表一個由express.Router()創建的對象 可定義多個路由規則\n  // app.get() // 當只有一個規則時 用app.get()直接回掉function 即可\n  \n  // const compiler = webpack(config);\n  // app.use(webpackDevMiddleware(compiler, { // app.use() =< 此方法是宣告使用一個路由，變數 index 就是引入 routers 資料夾裡的 index.route 檔案，該路徑詳細內容就在該文件中編輯。\n  //   noInfo: true,\n  //   publicPath: config.output.publicPath\n  // })) \n  // app.use(webpackHotMiddleware(compiler))\n\n  // app.get('/', function(req, res) {\n  //   // res.sendFile(__dirname + './dist/index.html')\n  //   res.sendFile(__dirname + '/index.html')\n  // })\n  \n  // const sheet = new ServerStyleSheet()\n\n  try {\n    \n    // app.use('/', express.static('dist')); // 放外面 css 就失效 ssr 也跟著壞 路徑改成只抓css? stylecomponent class 還在但失效\n    // app.use(express.static('dist')); // 有用middleware 使用app.use 反之 app.get\n\n    app.get('/', function(req, res) { // step2\n      try {\n        app.use('/', express.static('dist')); // step3 // 完成server 渲染<Html> , 需要把client side 靜態資源復原 (client.bundle.js || css) 取代<Html內容> 但事件消失 hydrate 也沒用\n        // 把client side 資源載進來 bundle.js server side render 才吃得到伺服器第一次渲染資料 但放在裡面後 css 會失效 (不確定是不是stylecomponent問題) css 改成由html.js 引入\n\n        // res.send is only on express server 只能調用一次 // 用於本機測試server 無論dev or production // 上傳至heroku or aws 會走上面 process.env.PORT的code\n        const helmet = Helmet.renderStatic();\n        const appHtml = renderToString(<App />);\n        \n        // 提供給 express.static 函數的路徑，是相對於您從中啟動 node 程序的目錄。如果您是從另一個目錄執行 Express 應用程式，保險作法是使用您想提供之目錄的絕對路徑\n        // https://expressjs.com/zh-tw/starter/static-files.html\n        // renderToStaticMarku 可能造成換閃一下 // https://www.jishuwen.com/d/2BoD/zh-tw\n        res.send(`<!doctype html>\\n${renderToStaticMarkup(<Html\n          helmet={helmet}\n          appHtml={appHtml}// 資料已經帶進去但server side 尚未render // test express router\n          // https://pjchender.github.io/2018/09/21/react-ssr-%E7%AD%86%E8%A8%98/\n          // https://github.com/jakoblind/universal-react-server-bundle\n          // https://medium.com/@slashtu/react-loadable-ssr-and-code-splitting-ede5b31baf35\n        />)}`);\n\n      } catch (err) {\n        console.log(err);\n      }\n    });\n\n    app.listen(port, host, function(error) {\n      if (error) {\n        console.error(error)\n      } else {\n        console.log('伺服器已啟動在 port %s . 打開 http://%s:%s/ 查看', port, host, port)\n      }\n    })\n  } catch (err) {\n    console.log('serverErrorCatch: ', err);\n  }\n  // finally {\n  //   sheet.seal();\n  // }\n\n}\n\n// can reference \n// https://iter01.com/11212.html\n// https://github.com/jakoblind/universal-react-server-bundle/blob/master/server.js\n\n// !!!\n// https://pjchender.github.io/2018/09/21/react-ssr-%E7%AD%86%E8%A8%98/\n\n// webpack build from 0 to 1\n// https://segmentfault.com/a/1190000015490721\n\n// React Loadable\n// https://medium.com/@slashtu/react-loadable-ssr-and-code-splitting-ede5b31baf35\n\n// React-Webpack4-Babel-setup(github repo)\n// https://github.com/BusiRaja/React-Webpack4-Babel-Setup\n\n// most compeleted CICD (contain docker aws nodejs github circleCI...)\n// https://blog.amowu.com/2015/04/devops-continuous-integration-delivery-docker-circleci-aws-beanstalk.html"],"sourceRoot":""}